#!/usr/bin/env bash
set -e

usage="usage: ./util/db_undo_migration path/to/migration/UYYYYMMDDHHMMSS_file.sql"

database_path=${DATABASE_URL##*/}
database_name=${database_path%%\?*}

migration_filename=$1
if [ ! -f "$migration_filename" ]; then
    echo "$usage"
    exit 0
fi

mysql \
    --user="$DATABASE_USERNAME" \
    --password="$DATABASE_PASSWORD" \
    "$database_name" \
    < "$migration_filename"